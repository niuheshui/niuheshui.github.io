<!DOCTYPE html>
<html lang="zh-cn">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>M1: 打印进程树(pstree) | niuheshui.github.io</title>
    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="description" content="南京大学 jyy 操作系统: 设计与实现(2024春季)">
    <meta name="generator" content="Hugo 0.122.0">
    
    
    
    
      <meta name="robots" content="noindex, nofollow">
    

    
<link rel="stylesheet" href="/ananke/css/main.min.css" >



    

    
      

    

    

    
      <link rel="canonical" href="https://niuheshui.github.io/post/os/m1/">
    

    <meta property="og:title" content="M1: 打印进程树(pstree)" />
<meta property="og:description" content="南京大学 jyy 操作系统: 设计与实现(2024春季)" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://niuheshui.github.io/post/os/m1/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2024-03-21T23:08:10+08:00" />
<meta property="article:modified_time" content="2024-03-21T23:08:10+08:00" />

<meta itemprop="name" content="M1: 打印进程树(pstree)">
<meta itemprop="description" content="南京大学 jyy 操作系统: 设计与实现(2024春季)"><meta itemprop="datePublished" content="2024-03-21T23:08:10+08:00" />
<meta itemprop="dateModified" content="2024-03-21T23:08:10+08:00" />
<meta itemprop="wordCount" content="1513">
<meta itemprop="keywords" content="os," /><meta name="twitter:card" content="summary"/><meta name="twitter:title" content="M1: 打印进程树(pstree)"/>
<meta name="twitter:description" content="南京大学 jyy 操作系统: 设计与实现(2024春季)"/>

	
  </head>

  <body class="ma0 avenir bg-near-white">

    
   
  

  <header>
    <div class="bg-black">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l justify-between items-center center">
    <a href="/" class="f3 fw2 hover-white no-underline white-90 dib">
      
        niuheshui.github.io
      
    </a>
    <div class="flex-l items-center">
      

      
        <ul class="pl0 mr3">
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="/about/" title="About 页">
              About
            </a>
          </li>
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="/post/" title="Articles 页">
              Articles
            </a>
          </li>
          
        </ul>
      
      
<div class="ananke-socials">
  
</div>

    </div>
  </div>
</nav>

    </div>
  </header>



    <main class="pb7" role="main">
      
  
  <article class="flex-l flex-wrap justify-between mw8 center ph3">
    <header class="mt4 w-100">
      <aside class="instapaper_ignoref b helvetica tracked ttu">
          
        Articles
      </aside>
      










  <div id="sharing" class="mt3 ananke-socials">
    
  </div>


      <h1 class="f1 athelas mt3 mb1">M1: 打印进程树(pstree)</h1>
      
      
      
      <time class="f6 mv4 dib tracked" datetime="2024-03-21T23:08:10+08:00">三月 21, 2024</time>
      

      
      
    </header>
    <div class="nested-copy-line-height lh-copy serif f4 nested-links mid-gray pr4-l w-two-thirds-l"><p>南京大学 jyy <a href="https://jyywiki.cn/OS/2024/">操作系统: 设计与实现(2024春季)</a></p>
<p><a href="https://jyywiki.cn/OS/2024/labs/M1.md">M1: 打印进程树 (pstree)</a></p>
<p><del>实现盗版<code>pstree</code></del></p>
<h3 id="参数解析">参数解析</h3>
<p>要求实现<code>-p</code>,<code>-n</code>,<code>-V</code>三个参数</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">static</span> <span style="color:#66d9ef">char</span> version[] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;pstree @niuheshui&#34;</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">static</span> <span style="color:#66d9ef">int</span> show_pids;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">static</span> <span style="color:#66d9ef">int</span> numeric_sort;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">static</span> <span style="color:#66d9ef">int</span> show_version;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/* 简单粗暴的参数解析 */</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>(<span style="color:#66d9ef">int</span> argc, <span style="color:#66d9ef">char</span><span style="color:#f92672">*</span> argv[]) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>; i <span style="color:#f92672">&lt;</span> argc; i<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">assert</span>(argv[i]);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">strcmp</span>(argv[i], <span style="color:#e6db74">&#34;-p&#34;</span>) <span style="color:#f92672">||</span> <span style="color:#f92672">!</span><span style="color:#a6e22e">strcmp</span>(argv[i], <span style="color:#e6db74">&#34;--show-pids&#34;</span>)) {
</span></span><span style="display:flex;"><span>      show_pids <span style="color:#f92672">=</span> true;
</span></span><span style="display:flex;"><span>    } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">strcmp</span>(argv[i], <span style="color:#e6db74">&#34;-n&#34;</span>) <span style="color:#f92672">||</span> <span style="color:#f92672">!</span><span style="color:#a6e22e">strcmp</span>(argv[i], <span style="color:#e6db74">&#34;--numeric-sort&#34;</span>)) {
</span></span><span style="display:flex;"><span>      numeric_sort <span style="color:#f92672">=</span> true;
</span></span><span style="display:flex;"><span>    } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">strcmp</span>(argv[i], <span style="color:#e6db74">&#34;-V&#34;</span>) <span style="color:#f92672">||</span> <span style="color:#f92672">!</span><span style="color:#a6e22e">strcmp</span>(argv[i], <span style="color:#e6db74">&#34;--version&#34;</span>)) { 
</span></span><span style="display:flex;"><span>      show_version <span style="color:#f92672">=</span> true;
</span></span><span style="display:flex;"><span>    } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">assert</span>(false);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">assert</span>(<span style="color:#f92672">!</span>argv[argc]);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (show_version) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">fprintf</span>(stderr, <span style="color:#e6db74">&#34;%s</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, version);
</span></span><span style="display:flex;"><span>  } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">pstree</span>();
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="获取进程信息">获取进程信息</h3>
<blockquote>
<p>Everything is a file.</p>
</blockquote>
<p>查看<a href="https://man7.org/linux/man-pages/man5/proc.5.html"><code>man 5 proc</code></a>中的<code>/proc/pid/stat</code>可以知道有关进程的信息</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ cat /proc/1006/stat
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">1006</span> <span style="color:#f92672">(</span>lightdm<span style="color:#f92672">)</span> S <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">1006</span> <span style="color:#ae81ff">1006</span> <span style="color:#ae81ff">0</span> -1 <span style="color:#ae81ff">4194560</span> <span style="color:#ae81ff">1356</span> <span style="color:#ae81ff">6446</span> <span style="color:#ae81ff">7</span> <span style="color:#ae81ff">66</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">4</span> <span style="color:#ae81ff">3</span> <span style="color:#ae81ff">20</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">3</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">873</span> <span style="color:#ae81ff">314454016</span> <span style="color:#ae81ff">1846</span> <span style="color:#ae81ff">18446744073709551615</span> <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">4097</span> <span style="color:#ae81ff">84482</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">17</span> <span style="color:#ae81ff">2</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span>
</span></span></code></pre></div><p>只用到了前五个字段</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#f92672">(</span>1<span style="color:#f92672">)</span> pid  %d
</span></span><span style="display:flex;"><span>  The process ID.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">(</span>2<span style="color:#f92672">)</span> comm  %s
</span></span><span style="display:flex;"><span>  The filename of the executable, in parentheses.
</span></span><span style="display:flex;"><span>  Strings longer than TASK_COMM_LEN <span style="color:#f92672">(</span>16<span style="color:#f92672">)</span> characters
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">(</span>including the terminating null byte<span style="color:#f92672">)</span> are silently
</span></span><span style="display:flex;"><span>  truncated.  This is visible whether or not the
</span></span><span style="display:flex;"><span>  executable is swapped out.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">(</span>3<span style="color:#f92672">)</span> state  %c
</span></span><span style="display:flex;"><span>  One of the following characters, indicating process
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">(</span>4<span style="color:#f92672">)</span> ppid  %d
</span></span><span style="display:flex;"><span>  The PID of the parent of this process.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">(</span>5<span style="color:#f92672">)</span> pgrp  %d
</span></span><span style="display:flex;"><span>  The process group ID of the process.
</span></span></code></pre></div><p>第五个乍一看好像没什么用, 但是使用一些神奇的<code>quick and dirty </code>之后</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ find /proc -maxdepth <span style="color:#ae81ff">2</span> -name <span style="color:#e6db74">&#34;stat&#34;</span>  | grep <span style="color:#e6db74">&#34;[0-9]&#34;</span> | xargs cat 
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">1</span> <span style="color:#f92672">(</span>systemd<span style="color:#f92672">)</span> S <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">0</span> -1 <span style="color:#ae81ff">4194560</span> <span style="color:#ae81ff">13672</span> <span style="color:#ae81ff">122025</span> <span style="color:#ae81ff">172</span> <span style="color:#ae81ff">1633</span> <span style="color:#ae81ff">19</span> <span style="color:#ae81ff">87</span> <span style="color:#ae81ff">109</span> <span style="color:#ae81ff">159</span> <span style="color:#ae81ff">20</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">13</span> <span style="color:#ae81ff">170434560</span> <span style="color:#ae81ff">2806</span> <span style="color:#ae81ff">18446744073709551615</span> <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">671173123</span> <span style="color:#ae81ff">4096</span> <span style="color:#ae81ff">1260</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">17</span> <span style="color:#ae81ff">14</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">2</span> <span style="color:#f92672">(</span>kthreadd<span style="color:#f92672">)</span> S <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> -1 <span style="color:#ae81ff">2129984</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">20</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">13</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">18446744073709551615</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">2147483647</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">3</span> <span style="color:#f92672">(</span>rcu_gp<span style="color:#f92672">)</span> I <span style="color:#ae81ff">2</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> -1 <span style="color:#ae81ff">69238880</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> -20 <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">24</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">18446744073709551615</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">2147483647</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">17</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">4</span> <span style="color:#f92672">(</span>rcu_par_gp<span style="color:#f92672">)</span> I <span style="color:#ae81ff">2</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> -1 <span style="color:#ae81ff">69238880</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> -20 <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">24</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">18446744073709551615</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">2147483647</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">17</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">5</span> <span style="color:#f92672">(</span>slub_flushwq<span style="color:#f92672">)</span> I <span style="color:#ae81ff">2</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> -1 <span style="color:#ae81ff">69238880</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> -20 <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">24</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">18446744073709551615</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">2147483647</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">17</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">6</span> <span style="color:#f92672">(</span>netns<span style="color:#f92672">)</span> I <span style="color:#ae81ff">2</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> -1 <span style="color:#ae81ff">69238880</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> -20 <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">24</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">18446744073709551615</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">2147483647</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">17</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">8</span> <span style="color:#f92672">(</span>kworker/0:0H-events_highpri<span style="color:#f92672">)</span> I <span style="color:#ae81ff">2</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> -1 <span style="color:#ae81ff">69238880</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> -20 <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">24</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">18446744073709551615</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">2147483647</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">17</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">9</span> <span style="color:#f92672">(</span>kworker/0:1-events<span style="color:#f92672">)</span> I <span style="color:#ae81ff">2</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> -1 <span style="color:#ae81ff">69239136</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">14</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">20</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">24</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">18446744073709551615</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">2147483647</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">17</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span>
</span></span></code></pre></div><p>会发现有一些奇怪的进程并没有在正版<code>pstree</code>中出现, 而且这些全都有一个显著特征, 那就是这些进程的<code>pgrp</code>都为<code>0</code></p>
<p>这些进程就是<a href="https://en.wikipedia.org/wiki/Process_identifier"><code>swapper</code></a></p>
<blockquote>
<p>There are two tasks with specially distinguished process IDs: swapper or sched has process ID 0 and is responsible for paging, and is actually part of the kernel rather than a normal user-mode process. Process ID 1 is usually the init process primarily responsible for starting and shutting down the system. Originally, process ID 1 was not specifically reserved for init by any technical measures: it simply had this ID as a natural consequence of being the first process invoked by the kernel. More recent Unix systems typically have additional kernel components visible as &lsquo;processes&rsquo;, in which case PID 1 is actively reserved for the init process to maintain consistency with older systems.</p>
</blockquote>
<p>已经知道从什么地方读取进程信息了, 接下来就是遍历目录和读取文件</p>
<p>读目录相关的<code>c</code>库函数有<a href="https://man7.org/linux/man-pages/man3/opendir.3.html"><code>opendir</code></a>,<a href="https://man7.org/linux/man-pages/man3/closedir.3.html"><code>closedir</code></a>,<a href="https://man7.org/linux/man-pages/man3/readdir.3.html"><code>readdir</code></a>,但有一个更方便的<a href="https://man7.org/linux/man-pages/man3/scandir.3.html"><code>scandir</code></a>支持文件的过滤和排序,对实现<code>-n</code>选项十分有利</p>
<h3 id="在内存建树">在内存建树</h3>
<p>使用<code>pnode</code>结构体表示树的一个节点</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">typedef</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">pid_t</span>   pid;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">pid_t</span>   ppid;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">char</span>    comm[<span style="color:#ae81ff">48</span>];
</span></span><span style="display:flex;"><span>  Array<span style="color:#f92672">*</span>  childs;
</span></span><span style="display:flex;"><span>} pnode;
</span></span></code></pre></div><p>自己实现了一个简单的动态数组<code>Array</code>, 定义如下</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">typedef</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">void</span><span style="color:#f92672">*</span> arr;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">int</span>   size; 
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">int</span>   capacity;
</span></span><span style="display:flex;"><span>} Array;
</span></span></code></pre></div><p>由于建树只涉及到节点的添加, 所以没有实现复杂的功能, 只有一个<code>add</code>函数来不断的添加元素以及一个必要的初始化函数和释放资源的函数</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span>Array <span style="color:#f92672">*</span><span style="color:#a6e22e">__array_init</span>(<span style="color:#66d9ef">int</span> type_size, <span style="color:#66d9ef">int</span> capacity) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (capacity <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>) capacity <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>  Array <span style="color:#f92672">*</span>array <span style="color:#f92672">=</span> (Array <span style="color:#f92672">*</span>)<span style="color:#a6e22e">malloc</span>(<span style="color:#66d9ef">sizeof</span>(Array));
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">assert</span>(array);
</span></span><span style="display:flex;"><span>  array<span style="color:#f92672">-&gt;</span>arr <span style="color:#f92672">=</span> <span style="color:#a6e22e">calloc</span>(capacity, type_size);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">assert</span>(array<span style="color:#f92672">-&gt;</span>arr);
</span></span><span style="display:flex;"><span>  array<span style="color:#f92672">-&gt;</span>size <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>  array<span style="color:#f92672">-&gt;</span>capacity <span style="color:#f92672">=</span> capacity;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> array;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">__array_add</span>(Array <span style="color:#f92672">*</span>a, <span style="color:#66d9ef">int</span> type_size, <span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>item) {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">assert</span>(a);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (a<span style="color:#f92672">-&gt;</span>size <span style="color:#f92672">==</span> a<span style="color:#f92672">-&gt;</span>capacity) {
</span></span><span style="display:flex;"><span>    a<span style="color:#f92672">-&gt;</span>capacity <span style="color:#f92672">*=</span> <span style="color:#ae81ff">2</span>;
</span></span><span style="display:flex;"><span>    a<span style="color:#f92672">-&gt;</span>arr <span style="color:#f92672">=</span> <span style="color:#a6e22e">realloc</span>(a<span style="color:#f92672">-&gt;</span>arr, type_size <span style="color:#f92672">*</span> a<span style="color:#f92672">-&gt;</span>capacity);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">assert</span>(a<span style="color:#f92672">-&gt;</span>arr);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">memcpy</span>(a<span style="color:#f92672">-&gt;</span>arr <span style="color:#f92672">+</span> ((a<span style="color:#f92672">-&gt;</span>size<span style="color:#f92672">++</span>) <span style="color:#f92672">*</span> type_size), item, type_size);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">array_free</span>(Array<span style="color:#f92672">*</span> a) {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">free</span>(a<span style="color:#f92672">-&gt;</span>arr);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">free</span>(a);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>使用宏定义提供访问接口实现泛型</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#75715e">#define array_init(type, capacity)    (__array_init(sizeof(type), (capacity)))
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#define array_size(array)             ((array)-&gt;size)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#define array_add(array, type, item)  (__array_add((array), sizeof(type), item))
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#define array_get(array, type, idx)   (((type *)(array-&gt;arr))[idx])
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#define array_forEach(array)          for (int i = 0; i &lt; (array)-&gt;size; i++)
</span></span></span></code></pre></div><h4 id="实现">实现</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">filter</span>(<span style="color:#66d9ef">const</span> <span style="color:#66d9ef">struct</span> dirent <span style="color:#f92672">*</span>d) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (d<span style="color:#f92672">-&gt;</span>d_type <span style="color:#f92672">!=</span> DT_DIR) <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">char</span><span style="color:#f92672">*</span> name <span style="color:#f92672">=</span> d<span style="color:#f92672">-&gt;</span>d_name;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; name[i]; i<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">isdigit</span>(name[i])) <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">compar</span>(<span style="color:#66d9ef">const</span> <span style="color:#66d9ef">struct</span> dirent <span style="color:#f92672">**</span> a,
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">struct</span> dirent <span style="color:#f92672">**</span> b) {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#define d_name(d) ((*(d))-&gt;d_name)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">assert</span>(<span style="color:#a6e22e">filter</span>(<span style="color:#f92672">*</span>a));
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">assert</span>(<span style="color:#a6e22e">filter</span>(<span style="color:#f92672">*</span>b));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">atoi</span>(<span style="color:#a6e22e">d_name</span>(b)) <span style="color:#f92672">-</span> <span style="color:#a6e22e">atoi</span>(<span style="color:#a6e22e">d_name</span>(a));
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">pstree</span>() {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">struct</span> dirent <span style="color:#f92672">**</span>namelist;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">int</span> n;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  Array<span style="color:#f92672">*</span> a <span style="color:#f92672">=</span> <span style="color:#a6e22e">array_init</span>(pnode<span style="color:#f92672">*</span>, <span style="color:#ae81ff">10</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  n <span style="color:#f92672">=</span> <span style="color:#a6e22e">scandir</span>(<span style="color:#e6db74">&#34;/proc&#34;</span>, <span style="color:#f92672">&amp;</span>namelist, filter, numeric_sort <span style="color:#f92672">?</span> compar : NULL);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (n <span style="color:#f92672">==</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">perror</span>(<span style="color:#e6db74">&#34;scandir&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">exit</span>(EXIT_FAILURE);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">pid_t</span> pid, ppid, pgrp;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">char</span> comm[<span style="color:#ae81ff">41</span>];
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">char</span> state;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">while</span> (n<span style="color:#f92672">--</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">sprintf</span>(name_buf, <span style="color:#e6db74">&#34;/proc/%s/stat&#34;</span>, namelist[n]<span style="color:#f92672">-&gt;</span>d_name);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">free</span>(namelist[n]);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    FILE<span style="color:#f92672">*</span> fp <span style="color:#f92672">=</span> <span style="color:#a6e22e">fopen</span>(name_buf, <span style="color:#e6db74">&#34;r&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span>fp) <span style="color:#66d9ef">goto</span> release;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/* 读取需要的信息 */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">fscanf</span>(fp, <span style="color:#e6db74">&#34;%d&#34;</span>, <span style="color:#f92672">&amp;</span>pid);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">fscanf</span>(fp, <span style="color:#e6db74">&#34;%s &#34;</span>, comm);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> len <span style="color:#f92672">=</span> <span style="color:#a6e22e">strlen</span>(comm);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (comm[len <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>] <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#39;)&#39;</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">fscanf</span>(fp, <span style="color:#e6db74">&#34;%s &#34;</span>, comm <span style="color:#f92672">+</span> len);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">fscanf</span>(fp, <span style="color:#e6db74">&#34;%c %d %d&#34;</span>, <span style="color:#f92672">&amp;</span>state, <span style="color:#f92672">&amp;</span>ppid, <span style="color:#f92672">&amp;</span>pgrp);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/* 添加节点 */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (pgrp) {
</span></span><span style="display:flex;"><span>      pnode<span style="color:#f92672">*</span> p <span style="color:#f92672">=</span> (pnode<span style="color:#f92672">*</span>)<span style="color:#a6e22e">malloc</span>(<span style="color:#66d9ef">sizeof</span>(pnode));
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">memset</span>(p<span style="color:#f92672">-&gt;</span>comm, <span style="color:#ae81ff">0</span>, <span style="color:#66d9ef">sizeof</span>(p<span style="color:#f92672">-&gt;</span>comm));
</span></span><span style="display:flex;"><span>      p<span style="color:#f92672">-&gt;</span>childs <span style="color:#f92672">=</span> <span style="color:#a6e22e">array_init</span>(<span style="color:#66d9ef">int</span>, <span style="color:#ae81ff">5</span>);
</span></span><span style="display:flex;"><span>      p<span style="color:#f92672">-&gt;</span>pid <span style="color:#f92672">=</span> pid;
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">sprintf</span>(p<span style="color:#f92672">-&gt;</span>comm, <span style="color:#e6db74">&#34;%s&#34;</span>, comm);
</span></span><span style="display:flex;"><span>      p<span style="color:#f92672">-&gt;</span>ppid <span style="color:#f92672">=</span> ppid;
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">array_add</span>(a, pnode<span style="color:#f92672">*</span>, <span style="color:#f92672">&amp;</span>p);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>release: 
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (fp) <span style="color:#a6e22e">fclose</span>(fp);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">free</span>(namelist);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">/* 创建父子关系 */</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">int</span> init_idx <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">array_forEach</span>(a) {
</span></span><span style="display:flex;"><span>    pnode<span style="color:#f92672">*</span> p <span style="color:#f92672">=</span> <span style="color:#a6e22e">array_get</span>(a, pnode<span style="color:#f92672">*</span>, i);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (p<span style="color:#f92672">-&gt;</span>pid <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span>) init_idx <span style="color:#f92672">=</span> i;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> idx <span style="color:#f92672">=</span> i;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">pid_t</span> ppid <span style="color:#f92672">=</span> p<span style="color:#f92672">-&gt;</span>ppid;
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">array_forEach</span>(a) {
</span></span><span style="display:flex;"><span>      pnode<span style="color:#f92672">*</span> pp <span style="color:#f92672">=</span> <span style="color:#a6e22e">array_get</span>(a, pnode<span style="color:#f92672">*</span>, i);
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (pp<span style="color:#f92672">-&gt;</span>pid <span style="color:#f92672">==</span> ppid) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">array_add</span>(pp<span style="color:#f92672">-&gt;</span>childs, <span style="color:#66d9ef">int</span>, <span style="color:#f92672">&amp;</span>idx);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">break</span>;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">/* 打印 */</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">print_tree</span>(a, init_idx, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">/* 释放资源 */</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">free</span>(a<span style="color:#f92672">-&gt;</span>arr);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">free</span>(a);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="打印进程树">打印进程树</h3>
<p>当在内存中建好进程树后将其打印</p>
<ol>
<li>打印格式需要的字符, 然后打印该节点对应的连接符和信息, 如果是<code>init</code>进程, 则只打印信息</li>
<li>如果该节点是叶子节点, 最后在打印换行</li>
<li>为子进程生成需要打印的格式字符串</li>
</ol>
<h4 id="实现-1">实现</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">print_tree</span>(Array<span style="color:#f92672">*</span> a, <span style="color:#66d9ef">int</span> idx, <span style="color:#66d9ef">char</span><span style="color:#f92672">*</span> pre_str, <span style="color:#66d9ef">int</span> start, <span style="color:#66d9ef">int</span> end) {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">assert</span>(idx <span style="color:#f92672">&lt;</span> <span style="color:#a6e22e">array_size</span>(a));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  pnode<span style="color:#f92672">*</span> p <span style="color:#f92672">=</span> <span style="color:#a6e22e">array_get</span>(a, pnode<span style="color:#f92672">*</span>, idx);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">int</span> is_root <span style="color:#f92672">=</span> (p<span style="color:#f92672">-&gt;</span>pid <span style="color:#f92672">==</span> ROOT_PID);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">int</span> is_leaf <span style="color:#f92672">=</span> (<span style="color:#a6e22e">array_size</span>(p<span style="color:#f92672">-&gt;</span>childs) <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">char</span> info[<span style="color:#ae81ff">64</span>];
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">sprintf</span>(info, show_pids <span style="color:#f92672">?</span> <span style="color:#e6db74">&#34;%s[%d]&#34;</span> <span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;%s&#34;</span>, p<span style="color:#f92672">-&gt;</span>comm, p<span style="color:#f92672">-&gt;</span>pid);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (is_root) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">printf</span>(<span style="color:#e6db74">&#34;%s&#34;</span>, info);
</span></span><span style="display:flex;"><span>  } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">printf</span>(<span style="color:#e6db74">&#34;%s%s%s&#34;</span>, 
</span></span><span style="display:flex;"><span>      start <span style="color:#f92672">?</span> <span style="color:#e6db74">&#34;&#34;</span> <span style="color:#f92672">:</span> pre_str, 
</span></span><span style="display:flex;"><span>      start <span style="color:#f92672">?</span> end <span style="color:#f92672">?</span> <span style="color:#e6db74">&#34;---&#34;</span> <span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;-+-&#34;</span> 
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">:</span> end <span style="color:#f92672">?</span> <span style="color:#e6db74">&#34; `-&#34;</span> <span style="color:#f92672">:</span> <span style="color:#e6db74">&#34; |-&#34;</span>, 
</span></span><span style="display:flex;"><span>      info);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (is_leaf) <span style="color:#a6e22e">printf</span>(<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">char</span> buf[<span style="color:#ae81ff">256</span>];
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">int</span> space_len <span style="color:#f92672">=</span> <span style="color:#a6e22e">strlen</span>(info);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (is_root) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">sprintf</span>(buf, <span style="color:#e6db74">&#34;%*.s&#34;</span>, space_len, <span style="color:#e6db74">&#34; &#34;</span>);
</span></span><span style="display:flex;"><span>  } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">sprintf</span>(buf, <span style="color:#e6db74">&#34;%s%s%*.s&#34;</span>, 
</span></span><span style="display:flex;"><span>      pre_str, 
</span></span><span style="display:flex;"><span>      end <span style="color:#f92672">?</span> <span style="color:#e6db74">&#34;   &#34;</span> <span style="color:#f92672">:</span> <span style="color:#e6db74">&#34; | &#34;</span>, 
</span></span><span style="display:flex;"><span>      space_len,
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34; &#34;</span>);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">/* 递归打印子进程 */</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">array_forEach</span>(p<span style="color:#f92672">-&gt;</span>childs) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">print_tree</span>(a, <span style="color:#a6e22e">array_get</span>(p<span style="color:#f92672">-&gt;</span>childs, <span style="color:#66d9ef">int</span>, i), buf, i <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>, i <span style="color:#f92672">==</span> <span style="color:#a6e22e">array_size</span>(p<span style="color:#f92672">-&gt;</span>childs) <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">/* 释放资源 */</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">array_free</span>(p<span style="color:#f92672">-&gt;</span>childs);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">free</span>(p);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="效果">效果</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ ./pstree-64 -n -p
</span></span><span style="display:flex;"><span><span style="color:#f92672">(</span>systemd<span style="color:#f92672">)[</span>1<span style="color:#f92672">]</span>-+-<span style="color:#f92672">(</span>systemd-journal<span style="color:#f92672">)[</span>326<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>             |-<span style="color:#f92672">(</span>systemd-udevd<span style="color:#f92672">)[</span>360<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>             |-<span style="color:#f92672">(</span>haveged<span style="color:#f92672">)[</span>726<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>             |-<span style="color:#f92672">(</span>systemd-oomd<span style="color:#f92672">)[</span>727<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>             |-<span style="color:#f92672">(</span>systemd-resolve<span style="color:#f92672">)[</span>730<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>             |-<span style="color:#f92672">(</span>systemd-timesyn<span style="color:#f92672">)[</span>731<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>             |-<span style="color:#f92672">(</span>acpid<span style="color:#f92672">)[</span>758<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>             |-<span style="color:#f92672">(</span>avahi-daemon<span style="color:#f92672">)[</span>762<span style="color:#f92672">]</span>---<span style="color:#f92672">(</span>avahi-daemon<span style="color:#f92672">)[</span>799<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>             |-<span style="color:#f92672">(</span>bluetoothd<span style="color:#f92672">)[</span>763<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>             |-<span style="color:#f92672">(</span>cron<span style="color:#f92672">)[</span>765<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>             |-<span style="color:#f92672">(</span>dbus-daemon<span style="color:#f92672">)[</span>766<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>             |-<span style="color:#f92672">(</span>NetworkManager<span style="color:#f92672">)[</span>768<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>             |-<span style="color:#f92672">(</span>irqbalance<span style="color:#f92672">)[</span>774<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>             |-<span style="color:#f92672">(</span>networkd-dispat<span style="color:#f92672">)[</span>775<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>             |-<span style="color:#f92672">(</span>polkitd<span style="color:#f92672">)[</span>776<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>             |-<span style="color:#f92672">(</span>rsyslogd<span style="color:#f92672">)[</span>777<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>             |-<span style="color:#f92672">(</span>systemd-logind<span style="color:#f92672">)[</span>783<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>             |-<span style="color:#f92672">(</span>udisksd<span style="color:#f92672">)[</span>787<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>             |-<span style="color:#f92672">(</span>wpa_supplicant<span style="color:#f92672">)[</span>789<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>             |-<span style="color:#f92672">(</span>ModemManager<span style="color:#f92672">)[</span>837<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>             |-<span style="color:#f92672">(</span>cupsd<span style="color:#f92672">)[</span>846<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>             |-<span style="color:#f92672">(</span>containerd<span style="color:#f92672">)[</span>856<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>             |-<span style="color:#f92672">(</span>sshd<span style="color:#f92672">)[</span>867<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>             |-<span style="color:#f92672">(</span>nvidia-persiste<span style="color:#f92672">)[</span>980<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>             |-<span style="color:#f92672">(</span>lightdm<span style="color:#f92672">)[</span>1006<span style="color:#f92672">]</span>-+-<span style="color:#f92672">(</span>Xorg<span style="color:#f92672">)[</span>1014<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>             |                 <span style="color:#e6db74">`</span>-<span style="color:#f92672">(</span>lightdm<span style="color:#f92672">)[</span>1278<span style="color:#f92672">]</span>---<span style="color:#f92672">(</span>i3<span style="color:#f92672">)[</span>1564<span style="color:#f92672">]</span>-+-<span style="color:#f92672">(</span>sh<span style="color:#f92672">)[</span>1613<span style="color:#f92672">]</span>---<span style="color:#f92672">(</span>xss-lock<span style="color:#f92672">)[</span>1616<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>             |                                                |-<span style="color:#f92672">(</span>sh<span style="color:#f92672">)[</span>1615<span style="color:#f92672">]</span>---<span style="color:#f92672">(</span>nm-applet<span style="color:#f92672">)[</span>1618<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>             |                                                |-<span style="color:#f92672">(</span>sh<span style="color:#f92672">)[</span>1621<span style="color:#f92672">]</span>---<span style="color:#f92672">(</span>fcitx5<span style="color:#f92672">)[</span>1623<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>             |                                                <span style="color:#e6db74">`</span>-<span style="color:#f92672">(</span>sh<span style="color:#f92672">)[</span>1958<span style="color:#f92672">]</span>---<span style="color:#f92672">(</span>kitty<span style="color:#f92672">)[</span>1959<span style="color:#f92672">]</span>---<span style="color:#f92672">(</span>fish<span style="color:#f92672">)[</span>2198<span style="color:#f92672">]</span>---<span style="color:#f92672">(</span>tmux:client<span style="color:#f92672">)[</span>3252<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>             |-<span style="color:#f92672">(</span>agetty<span style="color:#f92672">)[</span>1018<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>             |-<span style="color:#f92672">(</span>cups-browsed<span style="color:#f92672">)[</span>1116<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>             |-<span style="color:#f92672">(</span>dockerd<span style="color:#f92672">)[</span>1119<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>             |-<span style="color:#f92672">(</span>kerneloops<span style="color:#f92672">)[</span>1124<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>             |-<span style="color:#f92672">(</span>kerneloops<span style="color:#f92672">)[</span>1127<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>             |-<span style="color:#f92672">(</span>rtkit-daemon<span style="color:#f92672">)[</span>1162<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>             |-<span style="color:#f92672">(</span>x11vnc<span style="color:#f92672">)[</span>1402<span style="color:#f92672">]</span>---<span style="color:#f92672">(</span>x11vnc<span style="color:#f92672">)[</span>1403<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>             |-<span style="color:#f92672">(</span>systemd<span style="color:#f92672">)[</span>1552<span style="color:#f92672">]</span>-+-<span style="color:#f92672">((</span>sd-pam<span style="color:#f92672">))[</span>1553<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>             |                 |-<span style="color:#f92672">(</span>pipewire<span style="color:#f92672">)[</span>1559<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>             |                 |-<span style="color:#f92672">(</span>pipewire-media-<span style="color:#f92672">)[</span>1560<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>             |                 |-<span style="color:#f92672">(</span>pulseaudio<span style="color:#f92672">)[</span>1561<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>             |                 |-<span style="color:#f92672">(</span>dbus-daemon<span style="color:#f92672">)[</span>1565<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>             |                 |-<span style="color:#f92672">(</span>gvfsd<span style="color:#f92672">)[</span>1656<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>             |                 |-<span style="color:#f92672">(</span>gvfsd-fuse<span style="color:#f92672">)[</span>1668<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>             |                 |-<span style="color:#f92672">(</span>dconf-service<span style="color:#f92672">)[</span>1750<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>             |                 <span style="color:#e6db74">`</span>-<span style="color:#f92672">(</span>dunst<span style="color:#f92672">)[</span>1941<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>             |-<span style="color:#f92672">(</span>polybar<span style="color:#f92672">)[</span>1630<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>             |-<span style="color:#f92672">(</span>at-spi-bus-laun<span style="color:#f92672">)[</span>1631<span style="color:#f92672">]</span>---<span style="color:#f92672">(</span>dbus-daemon<span style="color:#f92672">)[</span>1650<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>             |-<span style="color:#f92672">(</span>agent<span style="color:#f92672">)[</span>1632<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>             |-<span style="color:#f92672">(</span>clash-verge<span style="color:#f92672">)[</span>1651<span style="color:#f92672">]</span>---<span style="color:#f92672">(</span>clash-meta<span style="color:#f92672">)[</span>1716<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>             |-<span style="color:#f92672">(</span>at-spi2-registr<span style="color:#f92672">)[</span>1685<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>             |-<span style="color:#f92672">(</span>chrome<span style="color:#f92672">)[</span>1883<span style="color:#f92672">]</span>-+-<span style="color:#f92672">(</span>cat<span style="color:#f92672">)[</span>1887<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>             |                |-<span style="color:#f92672">(</span>cat<span style="color:#f92672">)[</span>1888<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>             |                |-<span style="color:#f92672">(</span>chrome<span style="color:#f92672">)[</span>1898<span style="color:#f92672">]</span>---<span style="color:#f92672">(</span>chrome<span style="color:#f92672">)[</span>1924<span style="color:#f92672">]</span>---<span style="color:#f92672">(</span>chrome<span style="color:#f92672">)[</span>2078<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>             |                |-<span style="color:#f92672">(</span>chrome<span style="color:#f92672">)[</span>1899<span style="color:#f92672">]</span>---<span style="color:#f92672">(</span>chrome<span style="color:#f92672">)[</span>1901<span style="color:#f92672">]</span>-+-<span style="color:#f92672">(</span>chrome<span style="color:#f92672">)[</span>1935<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>             |                |                                 |-<span style="color:#f92672">(</span>chrome<span style="color:#f92672">)[</span>1964<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>             |                |                                 |-<span style="color:#f92672">(</span>chrome<span style="color:#f92672">)[</span>2005<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>             |                |                                 |-<span style="color:#f92672">(</span>chrome<span style="color:#f92672">)[</span>2068<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>             |                |                                 |-<span style="color:#f92672">(</span>chrome<span style="color:#f92672">)[</span>2118<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>             |                |                                 |-<span style="color:#f92672">(</span>chrome<span style="color:#f92672">)[</span>2128<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>             |                |                                 |-<span style="color:#f92672">(</span>chrome<span style="color:#f92672">)[</span>2137<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>             |                |                                 |-<span style="color:#f92672">(</span>chrome<span style="color:#f92672">)[</span>2143<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>             |                |                                 |-<span style="color:#f92672">(</span>chrome<span style="color:#f92672">)[</span>3150<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>             |                |                                 |-<span style="color:#f92672">(</span>chrome<span style="color:#f92672">)[</span>5832<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>             |                |                                 |-<span style="color:#f92672">(</span>chrome<span style="color:#f92672">)[</span>5986<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>             |                |                                 |-<span style="color:#f92672">(</span>chrome<span style="color:#f92672">)[</span>10159<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>             |                |                                 |-<span style="color:#f92672">(</span>chrome<span style="color:#f92672">)[</span>13355<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>             |                |                                 |-<span style="color:#f92672">(</span>chrome<span style="color:#f92672">)[</span>13576<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>             |                |                                 |-<span style="color:#f92672">(</span>chrome<span style="color:#f92672">)[</span>13871<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>             |                |                                 |-<span style="color:#f92672">(</span>chrome<span style="color:#f92672">)[</span>13986<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>             |                |                                 |-<span style="color:#f92672">(</span>chrome<span style="color:#f92672">)[</span>33675<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>             |                |                                 |-<span style="color:#f92672">(</span>chrome<span style="color:#f92672">)[</span>39435<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>             |                |                                 |-<span style="color:#f92672">(</span>chrome<span style="color:#f92672">)[</span>42379<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>             |                |                                 |-<span style="color:#f92672">(</span>chrome<span style="color:#f92672">)[</span>42951<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>             |                |                                 |-<span style="color:#f92672">(</span>chrome<span style="color:#f92672">)[</span>45230<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>             |                |                                 |-<span style="color:#f92672">(</span>chrome<span style="color:#f92672">)[</span>45299<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>             |                |                                 |-<span style="color:#f92672">(</span>chrome<span style="color:#f92672">)[</span>55588<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>             |                |                                 |-<span style="color:#f92672">(</span>chrome<span style="color:#f92672">)[</span>56451<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>             |                |                                 |-<span style="color:#f92672">(</span>chrome<span style="color:#f92672">)[</span>57446<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>             |                |                                 |-<span style="color:#f92672">(</span>chrome<span style="color:#f92672">)[</span>124297<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>             |                |                                 <span style="color:#e6db74">`</span>-<span style="color:#f92672">(</span>chrome<span style="color:#f92672">)[</span>135245<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>             |                |-<span style="color:#f92672">(</span>chrome<span style="color:#f92672">)[</span>1926<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>             |                <span style="color:#e6db74">`</span>-<span style="color:#f92672">(</span>chrome<span style="color:#f92672">)[</span>2927<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>             |-<span style="color:#f92672">(</span>chrome_crashpad<span style="color:#f92672">)[</span>1890<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>             |-<span style="color:#f92672">(</span>chrome_crashpad<span style="color:#f92672">)[</span>1892<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>             |-<span style="color:#f92672">(</span>upowerd<span style="color:#f92672">)[</span>1976<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>             |-<span style="color:#f92672">(</span>tmux:server<span style="color:#f92672">)[</span>3254<span style="color:#f92672">]</span>-+-<span style="color:#f92672">(</span>fish<span style="color:#f92672">)[</span>3255<span style="color:#f92672">]</span>---<span style="color:#f92672">(</span>make<span style="color:#f92672">)[</span>3925<span style="color:#f92672">]</span>---<span style="color:#f92672">(</span>hugo<span style="color:#f92672">)[</span>3926<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>             |                     |-<span style="color:#f92672">(</span>fish<span style="color:#f92672">)[</span>4303<span style="color:#f92672">]</span>---<span style="color:#f92672">(</span>pstree-64<span style="color:#f92672">)[</span>136393<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>             |                     <span style="color:#e6db74">`</span>-<span style="color:#f92672">(</span>fish<span style="color:#f92672">)[</span>41050<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>             |-<span style="color:#f92672">(</span>code<span style="color:#f92672">)[</span>3548<span style="color:#f92672">]</span>-+-<span style="color:#f92672">(</span>code<span style="color:#f92672">)[</span>3561<span style="color:#f92672">]</span>---<span style="color:#f92672">(</span>code<span style="color:#f92672">)[</span>3594<span style="color:#f92672">]</span>---<span style="color:#f92672">(</span>code<span style="color:#f92672">)[</span>3624<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>             |              |-<span style="color:#f92672">(</span>code<span style="color:#f92672">)[</span>3562<span style="color:#f92672">]</span>---<span style="color:#f92672">(</span>code<span style="color:#f92672">)[</span>3564<span style="color:#f92672">]</span>---<span style="color:#f92672">(</span>code<span style="color:#f92672">)[</span>3612<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>             |              |-<span style="color:#f92672">(</span>code<span style="color:#f92672">)[</span>3599<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>             |              |-<span style="color:#f92672">(</span>code<span style="color:#f92672">)[</span>3659<span style="color:#f92672">]</span>-+-<span style="color:#f92672">(</span>code<span style="color:#f92672">)[</span>3742<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>             |              |              <span style="color:#e6db74">`</span>-<span style="color:#f92672">(</span>code<span style="color:#f92672">)[</span>3957<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>             |              |-<span style="color:#f92672">(</span>code<span style="color:#f92672">)[</span>3672<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>             |              <span style="color:#e6db74">`</span>-<span style="color:#f92672">(</span>code<span style="color:#f92672">)[</span>3673<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>             |-<span style="color:#f92672">(</span>chrome_crashpad<span style="color:#f92672">)[</span>3578<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>             |-<span style="color:#f92672">(</span>fwupdmgr<span style="color:#f92672">)[</span>135372<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>             <span style="color:#e6db74">`</span>-<span style="color:#f92672">(</span>fwupd<span style="color:#f92672">)[</span>135385<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>$ ./pstree-64 -V
</span></span><span style="display:flex;"><span>pstree @niuheshui
</span></span><span style="display:flex;"><span>$ ./pstree-32 -n -p
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>$ ./pstree-32 -V
</span></span><span style="display:flex;"><span>pstree @niuheshui
</span></span></code></pre></div><ul class="pa0">
  
   <li class="list di">
     <a href="/tags/os/" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">os</a>
   </li>
  
</ul>
<div class="mt6 instapaper_ignoref">
      
      
      </div>
    </div>

    <aside class="w-30-l mt6-l">




</aside>

  </article>

    </main>
    <footer class="bg-black bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="https://niuheshui.github.io/" >
    &copy;  niuheshui.github.io 2024 
  </a>
    <div>
<div class="ananke-socials">
  
</div>
</div>
  </div>
</footer>

  </body>
</html>
